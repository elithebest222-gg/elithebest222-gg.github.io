<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <title>Unity WebGL Player | Hollow Knight</title>
    <link rel="shortcut icon" href="TemplateData/favicon.ico">
    <link rel="stylesheet" href="TemplateData/style.css">
    <style>
        html, body { margin:0; padding:0; width:100%; height:100%; overflow:hidden; background:#231F20; }
        #unity-container { width:100%; height:100%; position:fixed; top:0; left:0; }
        #unity-warning { position:absolute; top:10px; left:50%; transform:translateX(-50%); color:white; background:rgba(0,0,0,0.5); padding:10px; display:none; z-index:1000; }
    </style>

    <!-- GameMonetize SDK -->
    <script>
        window.SDK_OPTIONS = {
            gameId: "jp112o3o4hzgrnc7zaewjkrfk282pul8",
            onEvent: function(event) {
                switch(event.name){
                    case "SDK_GAME_PAUSE":
                        console.log("Game paused. Muting audio...");
                        if(window.unityInstance) window.unityInstance.SendMessage('AudioManager','MuteAudio');
                        break;
                    case "SDK_GAME_START":
                        console.log("Ad finished. Unmuting audio...");
                        if(window.unityInstance) window.unityInstance.SendMessage('AudioManager','UnmuteAudio');
                        break;
                    case "SDK_READY":
                        console.log("SDK ready.");
                        break;
                }
            }
        };
        (function(d, s, id){
            var js = d.getElementById(id);
            if(!js){
                js = d.createElement(s);
                js.id = id;
                js.src = "https://cdn.jsdelivr.net/gh/testamalame/sef@main/sedk.js";
                d.head.appendChild(js);
            }
        })(document,"script","gamemonetize-sdk");
    </script>
</head>
<body>
    <div id="unity-container" class="unity-desktop">
        <canvas id="unity-canvas"></canvas>
        <div id="unity-loading-bar">
            <div id="unity-logo"></div>
            <div id="unity-progress-bar-empty">
                <div id="unity-progress-bar-full"></div>
            </div>
        </div>
        <div id="unity-warning"></div>
    </div>

    <script>
        var canvas = document.querySelector("#unity-canvas");
        var container = document.querySelector("#unity-container");
        var loadingBarFull = document.querySelector("#unity-progress-bar-full");
        var warningBanner = document.querySelector("#unity-warning");

        function showBanner(msg, type){
            warningBanner.style.display = "block";
            warningBanner.innerText = msg;
            warningBanner.style.background = (type=="error")?"red":"yellow";
            setTimeout(()=>{ warningBanner.style.display="none"; }, 5000);
        }

        var config = {
            dataUrl: "Build/hk.data",
            frameworkUrl: "Build/hk.framework.js",
            codeUrl: "Build/hk.wasm",
            streamingAssetsUrl: "StreamingAssets",
            companyName: "Team Cherry & Truffled",
            productName: "Hollow Knight",
            productVersion: "1.0",
            showBanner: showBanner
        };

        var loaderScript = document.createElement("script");
        loaderScript.src = "Build/hk.loader.js";
        loaderScript.onload = () => {
            createUnityInstance(canvas, config, (progress) => {
                loadingBarFull.style.width = (progress*100)+"%";
            }).then((unityInstance)=>{
                window.unityInstance = unityInstance;

                // Show ad on first click
                canvas.addEventListener('pointerdown', ()=>{
                    if(typeof sdk !== 'undefined' && sdk.showBanner){
                        sdk.showBanner();
                        console.log("Ad shown.");
                    }
                });
            }).catch((err)=>{
                alert(err);
            });
        };
        document.body.appendChild(loaderScript);
    </script>
</body>
</html>
